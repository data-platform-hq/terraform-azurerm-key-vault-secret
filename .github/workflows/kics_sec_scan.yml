name: Run security KICS scaner

on: 
  #workflow_dispatch
  # push:
  pull_request:
    # The branches below must be a subset of the branches above
    branches:
    - main

jobs:
  kics:
    name: Run security KICS scaner
    runs-on: "ubuntu-latest"

    steps:
    - name: Checkout code repo
      uses: actions/checkout@v3

    - name: Run security KICS scaner
      uses: checkmarx/kics-github-action@v1.7.0
      with:
        path: .
        # token: ${{ secrets.GITHUB_TOKEN }}
        fail_on: high,medium
        enable_annotations: true
        # enable_comments: true
        # comments_with_queries: true
        output_formats: 'sarif'
        ignore_on_exit: results

    - name: Upload KICS scan results to GitHub Security tab
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: 'results.sarif'
